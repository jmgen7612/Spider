#!/usr/bin/env python3# -*- coding: utf-8 -*-#@file   :DownLoadVideoAndText.py#@time   :2018/5/13 21:50#@Author :jmgen#@Version:1.0#@Desc   :#!/usr/bin/env python3# -*- coding: utf-8 -*-#@file   :VideoAndImgToText.py#@time   :2018/5/12 23:16#@Author :jmgen#@Version:1.0#@Desc   :from urllib import requestimport requestsimport os,re,random,chardetdef Schedule(blocknum,blocksize,totalsize):    '''''    blocknum:已经下载的数据块    blocksize:数据块的大小    totalsize:远程文件的大小    '''    per = 100.0 * blocknum * blocksize / totalsize    if per > 100 :        per = 100    print('当前下载进度：%d'%per)def download_video(url,name):    i=0    headers = [('User - Agent', 'Mozilla/5.0 (Windows; U; Windows NT 5.2) AppleWebKit/525.17'                              ' (KHTML, like Gecko) Version/3.1 Safari/525.17'),]    opener = request.build_opener()    opener.addheaders = headers    request.install_opener(opener)    os.chdir('D:\\PyCharm\\workspace\\SpiderDemo\\text\\视频')    print(url)    request.urlretrieve(url, name+ '.mp4', Schedule)def download_img(url,name):    i=0    headers = [('User - Agent', 'Mozilla/5.0 (Windows; U; Windows NT 5.2) AppleWebKit/525.17'                              ' (KHTML, like Gecko) Version/3.1 Safari/525.17'),]    opener = request.build_opener()    opener.addheaders = headers    request.install_opener(opener)    os.chdir('D:\\PyCharm\\workspace\\SpiderDemo\\text\\图片')    for img_url in url:        print(img_url)        request.urlretrieve(img_url, name +str(i)+ '.jpg', Schedule)        i+=1def random_ip():    a=random.randint(1,255)    b=random.randint(1,255)    c=random.randint(1,255)    d=random.randint(1,255)    return(str(a)+'.'+str(b)+'.'+str(c)+'.'+str(d))flag=1while flag<=2:    tittle = []    base_url = 'http://www.80pcpc.com/video/'    page_url = 'http://www.80pcpc.com/diao/se57_'+str(flag)+'.html'    print(page_url)    get_page = requests.get(url=page_url)    viewkey=re.findall(r'href="/video/(.*).html',str(get_page.content,'utf-8',errors='ignore'))    video_url = []    img_url = []    list = []    video=[]    for key in viewkey:        # print(key)        headers = {'Accept-Language': 'zh-CN,zh;q=0.9',                   'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.106 Safari/537.36',                   'X-Forwarded-For': random_ip(), 'referer': page_url,                   'Content-Type': 'multipart/form-data; session_language=cn_CN'}        try:            base_req = requests.get(url=base_url + key + ".html", headers=headers)            base_req.encoding = chardet.detect(base_req.content)["encoding"]            # print(base_url + key+".html")            video_url = re.findall(r'video=\["(.*)"\]',                                   str(base_req.content, 'utf-8', errors='ignore'))            # print(video_url[0])            tittle = re.findall(r'<title>(.*?)-32pao视频免费在线视频</title>', str(base_req.content, 'GB2312', errors='ignore'),                                re.S)            img_url = re.findall(r'<img src="(.*?)" title=', str(base_req.content, 'utf-8', errors='ignore'))        except:            print("打开页面异常")        try:            list.append({'title': tittle, 'video_url': video_url[0],'img_url': img_url})            video.append({video_url[0]: tittle[0]},)        except:            print("页面异常")        # print(img_url)        download_video(video_url[0], str(tittle))        try:            print('开始下载:' + str(tittle))            # download_img(img_url,str(tittle))            download_video(video_url[0],str(tittle))        except:            print("生成文本异常")        try:            pass        except:            print("保存失败")    flag = flag + 1    print('此页已下载完成，下一页是' + str(flag))