#!/usr/bin/env python3# -*- coding: utf-8 -*-#@file   :LagouSpider.py#@time   :2018/5/26 13:48#@Author :jmgen#@Version:1.0#@Desc   :import urllib.requestimport urllib.parseimport jsondef open_url(url,page_num,keywords):    try:        #设置post请求参数        page_data=urllib.parse.urlencode([                                   ('pn',page_num),                                   ('kd',keywords)                                   ])        #设置headers        page_headers={'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.221 Safari/537.36 SE 2.X MetaSr 1.0',        'Connection': 'keep-alive',        'Host': 'www.lagou.com',        'Origin': 'https://www.lagou.com',        'Cookie': 'JSESSIONID=ABAAABAAAGGABCB3695C31A710229B73200AB551E0288B0; _ga=GA1.2.1913932621.1527268687; _gid=GA1.2.1394737526.1527268687; user_trace_token=20180526011844-ad402ed4-603f-11e8-9e48-525400f775ce; LGUID=20180526011844-ad4032f3-603f-11e8-9e48-525400f775ce; index_location_city=%E6%B7%B1%E5%9C%B3; X_HTTP_TOKEN=323927b0a27d300fb0aea4843ae52ab8; ab_test_random_num=0; Hm_lvt_4233e74dff0ae5bd0a3d81c6ccf756e6=1527268687,1527268702,1527313955; SEARCH_ID=79f4dc43d8744c20b521cb83aa005859; Hm_lpvt_4233e74dff0ae5bd0a3d81c6ccf756e6=1527314039; LGRID=20180526135436-4564cdd0-60a9-11e8-9f0b-525400f775ce; TG-TRACK-CODE=jobs_code',        'Accept': 'application/json, text/javascript, */*; q=0.01',        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',        'Referer': 'https://www.lagou.com/jobs/list_%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98?labelWords=&fromSearch=true&suginput=',        'X-Anit-Forge-Token': 'None',        'X-Requested-With': 'XMLHttpRequest'    }        #打开网页        req=urllib.request.Request(url,headers=page_headers)        content=urllib.request.urlopen(req,data=page_data.encode('utf-8')).read().decode('utf-8')        return content    except Exception as e:        print(str(e))#获取招聘职位信息def get_position(url,page_num):    try:        page_content=open_url(url,page_num,keywords)        data=json.loads(page_content)        content=data.get('content')        result=[('positionId','职位ID'),('positionName','职位名称'),('salary','薪资'),('createTime','发布时间'),('workYear','工作经验'),('education','学历'),('positionLables','职位标签'),('jobNature','职位类型'),('firstType','职位大类'),('secondType','职位细类'),('positionAdvantage','职位优势'),('city','城市'),('district','行政区'),('businessZones','商圈'),('publisherId','发布人ID'),('companyId','公司ID'),('companyFullName','公司名'),('companyShortName','公司简称'),('companyLabelList','公司标签'),('companySize','公司规模'),('financeStage','融资阶段'),('industryField','企业领域'),('industryLables','企业标签')]        positionResult=content.get('positionResult').get('result')        if(len(positionResult)>0):            for position in positionResult:                with open("position.txt",'a') as fh:                    fh.write("---------------------------\n")                    print(position)                    print(type(position))                for r in result:                    with open("position.txt",'a') as fh:                        fh.write(str(r[1])+":"+str(position.get(r[0]))+"\n")        return len(positionResult)    except Exception as e:        print(str(e))#爬取拉勾网招聘职位信息if __name__=="__main__":    #爬取起始页    url='https://www.lagou.com/jobs/positionAjax.json?px=default&yx=15k-25k&city=%E6%B7%B1%E5%9C%B3&district=%E5%8D%97%E5%B1%B1%E5%8C%BA&needAddtionalResult=false'    #设置查询的关键词    keywords="软件测试工程师"    page_num=1    while True:        print("正在爬取第" + str(page_num) + "页......")        result_len = get_position(url, page_num)        if(result_len>0):            page_num+=1        else:            break    print("爬取完成")